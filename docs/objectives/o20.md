---
icon: material/database-settings-outline
---

# Hack-a-Gnome

**Difficulty**: :fontawesome-solid-snowflake:{ .red }:fontawesome-solid-snowflake:{ .red }:fontawesome-solid-snowflake:{ .red }:fontawesome-regular-snowflake::fontawesome-regular-snowflake:<br/>
**Direct link**: [Objective6.zip](https://.../)

## Objective

!!! question "Request"
    Davis in the Data Center is fighting a gnome army—join the hack-a-gnome fun.

??? quote "Chris Davis"
    Hey, I could really use another set of eyes on this gnome takeover situation.

    Their systems have multiple layers of protection now - database authentication, web application vulnerabilities, and more!

    But every system has weaknesses if you know where to look.

    If these gnomes freeze the whole neighborhood, forget about hiking or kayaking—everything will be one giant ice rink. And trust me, miniature war gaming is a lot less fun when your paint freezes solid.

    Ready to help me turn one of these rebellious bots against its own kind?

## Hints

??? tip "Hack-A-Gnome"
    Sometimes, client-side code can interfere with what you submit. Try proxying your requests through a tool like Burp Suite or OWASP ZAP. You might be able to trigger a revealing error message.

??? tip "Hack-A-Gnome"
    Oh no, it sounds like the CAN bus controls are not sending the correct signals! If only there was a way to hack into your gnome's control stats/signal container to get command-line access to the smart-gnome. This would allow you to fix the signals and control the bot to shut down the factory. During my development of the robotic prototype, we found the factory's pollution to be undesirable, which is why we shut it down. If not updated since then, the gnome might be running on old and outdated packages.

??? tip "Hack-A-Gnome"
    I actually helped design the software that controls the factory back when we used it to make toys. It's quite complex. After logging in, there is a front-end that proxies requests to two main components: a backend Statistics page, which uses a per-gnome container to render a template with your gnome's stats, and the UI, which connects to the camera feed and sends control signals to the factory, relaying them to your gnome (assuming the CAN bus controls are hooked up correctly). Be careful, the gnomes shutdown if you logout and also shutdown if they run out of their 2-hour battery life (which means you'd have to start all over again).

??? tip "Hack-A-Gnome"
    Once you determine the type of database the gnome control factory's login is using, look up its documentation on default document types and properties. This information could help you generate a list of common English first names to try in your attack.

??? tip "Hack-A-Gnome"
    Nice! Once you have command-line access to the gnome, you'll need to fix the signals in the `canbus_client.py` file so they match up correctly. After that, the signals you send through the web UI to the factory should properly control the smart-gnome. You could try sniffing CAN bus traffic, enumerating signals based on any documentation you find, or brute-forcing combinations until you discover the right signals to control the gnome from the web UI.

??? tip "Hack-A-Gnome"
    There might be a way to check if an attribute IS_DEFINED on a given entry. This could allow you to brute-force possible attribute names for the target user's entry, which stores their password hash. Depending on the hash type, it might already be cracked and available online where you could find an online cracking station to break it.

## Solution

![Factory](../img/objectives/o20/data-center.png)

The first challenge was just to navigate the deprecated data center to find the elevator. Once I found the challenge, there are multiple layers to it and we start with the terminal opening to a login prompt to access the Smart Gnome unit.

![challenge](../img/objectives/o20/gnome-factory.png)

![login](../img/objectives/o20/factory-login.png)

### Logging In

#### Username

As usual when there is a browser interface, I put the site into BurpSuiteCommunity and started interacting with the login page. I attempted to use the **Register** button to create a new account and to login with assumed wrong information.

![register](../img/objectives/o20/account-creation.png)
![closed](../img/objectives/o20/registration-closed.png)
![failure](../img/objectives/o20/wrong-login.png)

While on the create account page, BurpSuite sent out a `GET` request for each character as it was being typed to check for availability at `/userAvailable` endpoint. I sent one of the `GET` requests to BurpSuite Repeater and began to search for errors. As was shown is some of the other challenges, sometimes an error can tell us as much, if not more, as a success will.<br/>
There are various ways to approach enumerating an unknown like what we see here but I like Repeater where I can test different payloads one at a time and view the responses. I was able to trigger the below error by testing various inputs.

![error](../img/objectives/o20/found-error.png)

!!! success "Error"
    The error response gives us our next clue!
    ```js
    {"error":"An error occurred while checking username: Message: {\"errors\":[{\"severity\":\"Error\",\"location\":{\"start\":44,\"end\":45},\"code\":\"SC1012\",\"message\":\"Syntax error, invalid string literal token '\\\"'.\"}]}\r\nActivityId: 92a39f33-b58b-4f01-9008-d277e43f7e92, Microsoft.Azure.Documents.Common/2.14.0"}
    ```

Great! With this info I am able to determine that the database is probably [Azure Cosmos DB](https://learn.microsoft.com/en-us/azure/cosmos-db/) and that it is using a SQL API. Based off the hint, we should be able to brute force a valid username, which should be a common english name. Some quick searches online or query to an LLM can easily produce a list of common english names. Moving into BurpSuite I sent the `/userAvailable` GET request to Intruder.<br/>
Using the Sniper Attack funtion and a wordlist of common english first names it is possible to find two valid usernames.

![username](../img/objectives/o20/username-search.png)

!!! warning "Response"
    A couple of things to be aware of. 
    1. BurpSuite Community has rate limiting in place. There are alternatives to finding the username without BurpSuite that can be used if this is an issue such as FFuF. 
    2. The response is 200 no matter what the payload is so that's not going to be a viable filter. It's neccessary to check the response for the `"available":false` response in order to find a valid username.
    ![sniper](../img/objectives/o20/sniper.png)

I found two usernames that are not available, meaning we have two targets that we can try to retrieve the password for. In order to retrieve the password with a SQL injection attack however, the name of the password field in the database is needed. This was the next big hurdle for me but eventually I saw hints in Discord pointing to the missing key. Using FFuF and a SecList wordlist for web content I enumerated the password field. 

#### Password

With half of the login found, we just have to figure out the password now. I fumbled around quite a bit for this before a comment from a helpful community member put me on the right track. The name of the password field is needed

This section explains the different steps taken to solve the challenge. Try to find a good balance between providing sufficient detail and not overloading the reader with too much information. Use [admonitions](https://squidfunk.github.io/mkdocs-material/reference/admonitions/), [images](https://squidfunk.github.io/mkdocs-material/reference/images/), [diagrams](https://squidfunk.github.io/mkdocs-material/reference/diagrams/), [code blocks](https://squidfunk.github.io/mkdocs-material/reference/code-blocks/), and [tables](https://squidfunk.github.io/mkdocs-material/reference/data-tables/) to highlight and structure important information or provide additional clarification.

### Admonitions

!!! warning "Anchor the decorations"
    Ensure that all festive decorations, especially electrical ones, are securely anchored. We don’t want them floating off into the tropical sunset!

!!! info "Palm tree lighting tip"
    While on the island, make sure to hang your Christmas lights on a palm tree. It’s not only festive but also a great beacon for Santa to find you!

### Images

![Terminal output](../img/objectives/o5/terminal_output_o5.png)

### Diagrams

```mermaid
sequenceDiagram
  autonumber
  Santa->>Elf: Hey Elf, is the Naughty-or-Nice List secured?
  loop Security Check
      Elf->>Elf: Ensuring list is encrypted
  end
  Note right of Elf: Using candy-cane encryption!
  Elf-->>Santa: Safe and sound, Santa!
  Santa->>Reindeer: Rudolph, did you patch the sleigh's software?
  Note left of Reindeer: Checking for reindeerOS updates...
  Reindeer-->>Santa: All patched and glowing bright!
```

### Code blocks

```bash linenums="1" hl_lines="7" title="Countdown script (with line 7 highlighted)"
#!/bin/bash
echo "Christmas Holiday Countdown"

days_until_xmas=$(($(date -d "Dec 25" +%j) - $(date +%j)))

if [ $days_until_xmas -ge 0 ]; then
  echo "Only $days_until_xmas days until Christmas!"
else
  echo "Christmas has passed! Hope you had a great time!"
fi
```

### Tables

| Activity             | Santa's Verdict       | Elf Comments                    |
| :------------------- | :-------------------- | :------------------------------ |
| Iceberg Surfing      | Risky Business        | "Lost three surfboards!"        |
| Polar Bear Hugs      | Approach with Caution | "Fluffy but... brisk."          |
| Snow Fort Building   | Highly Recommended    | "Elf-sized doorways only."      |
| Aurora Light Chasing | Magical Experience    | "Better than Christmas lights!" |
| Penguin Parade       | Absolute Must-See     | "They're oddly organized!"      |

!!! success "Answer"
    Insert the answer to the objective here.

## Response

!!! quote "Insert Character Name"
    Excellent work! You've successfully taken control of the gnome - look at that interface responding to our commands now.

    Time to turn this little rebel against its own manufacturing operation and shut them down for good!