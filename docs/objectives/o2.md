---
icon: material/code-block-tags
---

# It's All About Defang

**Difficulty**: :fontawesome-solid-snowflake:{ .red }:fontawesome-regular-snowflake::fontawesome-regular-snowflake::fontawesome-regular-snowflake::fontawesome-regular-snowflake:<br/>

![Ed's Office](../img/objectives/o2/defang.png)

## Objective

!!! question "Request"
    Find Ed Skoudis upstairs in City Hall and help him troubleshoot a clever phishing tool in his cozy office.

??? quote "Ed Skoudis"
    Oh gosh, I could talk for hours about this stuff but I really need your help!

    The team has been working on this new SOC tool that helps triage phishing emails...and there are some...issues.

    We have had some pretty sketchy emails coming through and we need to make sure we block ALL of the indicators of compromise.

    Can you help me? No pressure...

## Hints

??? tip "Extract IOCs"
    Remember, the new Phishing Threat Analysis Station (PTAS) is still under construction. Even though the regex patterns are provided, they haven't been fine tuned. Some of the matches may need to be manually removed.

??? tip "Defang All The Thingz"
    The PTAS does a pretty good job at defanging, however, the feature we are still working on is one that defangs ALL scenarios. For now, you will need to write a custom `sed` command combining all defang options.

## Solution

![PTAS](../img/objectives/o2/defang_terminal.png)

The terminal link opens the *Dosis Neighborhood SOC* displaying an email and steps for investigating it. 

!!! note "Phishing Email"
    From: "Icicle Innovations" <sales@icicleinnovations.mail>
    To: "Neighborhood Watch" <residents@dosisneighborhood.corp>
    Subject: ðŸŽ„ URGENT: Holiday Kitchen Makeover - Smart Home Integration! ðŸŽ„
    Date: Wed, 25 Dec 2025 09:15:33 -0500
    Message-ID: <holiday2025-kitchen@dosisneighborhood.corp>
    MIME-Version: 1.0
    Content-Type: text/plain; charset="UTF-8"
    X-Mailer: KitchenAlert v2.025
    Received: from mail.icicleinnovations.mail (172.16.254.1) by dosisneighborhood.corp (10.0.0.5) with SMTP;
         Wed, 25 Dec 2025 09:15:28 -0500
    Received: from core.icicleinnovations.mail (192.168.1.1) by mail.icicleinnovations.mail (172.16.254.1);
         Wed, 25 Dec 2025 09:15:22 -0500

    Dear Valued Dosis Neighborhood Residents,

    ðŸš¨ IMMEDIATE ACTION REQUIRED ðŸš¨

    Our elite team of Sunny's kitchen renovation specialists have detected some SERIOUSLY outdated kitchen setups in your neighborhood! It appears that certain homes are still using legacy appliances without proper smart home integration - like non-IoT fridges that can't automatically order milk, or microwaves that don't sync with your meal planning apps! 

    While this sounds like a delightfully festive renovation opportunity (and totally not a security assessment), we need you to:

    1. Download our FREE Kitchen Renovation Plannerâ„¢ with built-in security features (totally legit, we promise!): https://icicleinnovations.mail/renovation-planner.exe
   
    2. Upload high-resolution photos of your current kitchen to our secure design portal (we need to see ALL angles for proper renovation planning): https://icicleinnovations.mail/upload_photos

    For instant help with any kitchen renovation questions, contact our 24/7 design hotline at 523.555.0100 or our renovation specialists at 523.555.0101.

    Remember: If your old appliances start acting up during the assessment, it's probably just excitement about their upcoming upgrades! But please document any issues with photos.

    Stay merry (and consider smart upgrades),
    Icicle Innovations 
    Chief Kitchen Design Specialist
    ðŸ“ž 523.555.RENO
    info@icicleinnovations.mail

    P.S. - Has anyone else noticed their kitchen cabinets mysteriously rearranging themselves overnight? We can fix that with proper smart storage solutions!

### Step 1: Extract IOCs

!!! danger "Extract IOCs"
    This phishing email may be connected to the mysterious Gnome activities reported throughout our neighborhood! Extracting IOCs (Indicators of Compromise) is essential to protect the Counter Hack Crew and identify the threat actors behind this campaign. Your mission:

    - [ ] Extract all suspicious **domains**, **IPs**, **URLs**, and **email address**.

PTAS has seperated each objective into a seperate tab, [++"DOMAIN"++](#domains), [++"IP ADDRESSES"++](#ip-addresses), [++"URLS"++](#urls), and [++"EMAIL ADDRESSES"++](#email-addresses)

#### Domains

To search the email for domains, we need a regex pattern that will find web addresses in the email.

??? tip "What are Domains?"
    Domains are human-readable web addresses (like example.com) that map to IP addresses. They often indicate the source or destination of malicious activity.

In the informatinal blurb about what a domain is, there is also a link to the reference tab (seen below) that provides some useful RegEx commands as well as resource links. Under "Common IOC patterns" can be found a regex pattern for detecting domains, `[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+`. That seems to just what is needed; copy and pasting it in the field returns a bit more than expected though, with a total of 14 domains found.

??? warning "Fine Tuning"
    If you read the hint provided, "Extract IOCs", you'll see that there is a warning about the PTAS being new and the RegEx patterns provided not all being fine tuned. In this case, that means needing to remove some of the findings. For other IOCs such as **IP Addresses**, it is necessary to adjust the RegEx Pattern.

![Domains found](../img/objectives/o2/domains.png)

Remove those found which are not domains and there should be left with each domain IOC highlighted and color coded on the phishing email.

![Highlights](../img/objectives/o2/email_domain.png)

Going through the other tabs with the RegEx pattern from the reference tab as a starting point to find and highlight the **IP ADDRESSES**, **URLS**, & **EMAIL ADDRESSES**. When you select the ++"EXTRACT"++ button, the phishing email will be highlighted with the corresponding color. Afterwards, review the matches and remove any that don't belong.

#### IP Addresses

??? info "What are IP Addresses?"
    IP addresses are numerical labels (like 192.168.1.1) that identify devices on a network. Malicious IPs may host command & control servers or malware.

The RegEx pattern for IP Addresses from the reference tab is `\d{1,3}\.\d{1,3}\.\d{1,3}` but if this pattern is used as is, you'll notice that the values returned do not match the ip addresses correctly. The pattern provided is not quite complete.

![IP Addresses](../img/objectives/o2/IP_addresses.png)

A more fine tuned pattern will match the final octet, which will provide complete IP addresses without including any false matches and can be done using `\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}`.

#### URLs

??? info "What are URLs?"
    URLs are web addresses (like http://example.com/path) that point to specific resources. Malicious URLs often lead to phishing sites or malware downloads.

To find URLs with RegEx use `https://[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+(:[0-9]+)?(/[^\s]*)?`

![URLS](../img/objectives/o2/urls.png)

#### Email Addresses

??? info "What are Email Addresses?"
    Email addresses (like user@example.com) identify senders and recipients. In security analysis, they can reveal phishing campaign sources or targets.

Email addresses can be found with `\b[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}\b`

![email addresses](../img/objectives/o2/emails.png)

After completing each RegEx extraction, the results are highlighted with color coding, a different color for each IOC.

- [x] Extract all suspicious **domains**, **IPs**, **URLs**, and **email address**.

![Highlighted](../img/objectives/o2/highlighted_email.png)

!!! warning "Objective Note"
    A final note on extracting IOCs from the email. Remember that the objective for this step is "Extract all ==suspicious== domains, IPs, URLs, and email addresses". Just because something is a match for the regex pattern that is being used does not necessarily mean that the match is suspicious. A search pattern that matches emails will match both sender and receiver emails. It is the analyst's job to then decide which matches are an indicator of compromise to report, and which are benign aspects of the organization. Only include those indicators that are not legitimate. 

---

### Step 2: Defang & Report

Once all of the Indicators of Compromise have been found and highlighted within the phishing email, it's time to move to step 2, which is to defang the IOCs and report the findings.

!!! info "What is defanging"
    Defanging is a safety step of preventing indicators of compromise from accidentally being executed by changing or removing parts that break automatic functionality, such as wrapping a period or '@' with brackets (`[.]` & `[@]`). 

!!! warning "Defang IOCs"
    Defanging IOCs (Indicators of Compromise) is crucial to ensure that malicious content cannot be accidentally activated. This phishing campaign may be connected to the recent Gnome activities! Your mission:

    - [ ] Replace dots/periods with [.]<br/>
    - [ ] Replace @ in email addresses with [@]<br/>
    - [ ] Replace http with hxxp in URLs<br/>
    - [ ] Replace :// with [://] in URLs<br/>
    - [ ] Submit the defanged IOCs to the Counter Hack <br/>
    - [ ] Security Team <br/> 

![Defang&Report](../img/objectives/o2/defang_objective.png)



This section explains the different steps taken to solve the challenge. Try to find a good balance between providing sufficient detail and not overloading the reader with too much information. Use [admonitions](https://squidfunk.github.io/mkdocs-material/reference/admonitions/), [images](https://squidfunk.github.io/mkdocs-material/reference/images/), [diagrams](https://squidfunk.github.io/mkdocs-material/reference/diagrams/), [code blocks](https://squidfunk.github.io/mkdocs-material/reference/code-blocks/), and [tables](https://squidfunk.github.io/mkdocs-material/reference/data-tables/) to highlight and structure important information or provide additional clarification.

### Admonitions

!!! warning "Anchor the decorations"
    Ensure that all festive decorations, especially electrical ones, are securely anchored. We donâ€™t want them floating off into the tropical sunset!

!!! info "Palm tree lighting tip"
    While on the island, make sure to hang your Christmas lights on a palm tree. Itâ€™s not only festive but also a great beacon for Santa to find you!

### Diagrams

```mermaid
sequenceDiagram
  autonumber
  Santa->>Elf: Hey Elf, is the Naughty-or-Nice List secured?
  loop Security Check
      Elf->>Elf: Ensuring list is encrypted
  end
  Note right of Elf: Using candy-cane encryption!
  Elf-->>Santa: Safe and sound, Santa!
  Santa->>Reindeer: Rudolph, did you patch the sleigh's software?
  Note left of Reindeer: Checking for reindeerOS updates...
  Reindeer-->>Santa: All patched and glowing bright!
```

### Code blocks

```bash linenums="1" hl_lines="7" title="Countdown script (with line 7 highlighted)"
#!/bin/bash
echo "Christmas Holiday Countdown"

days_until_xmas=$(($(date -d "Dec 25" +%j) - $(date +%j)))

if [ $days_until_xmas -ge 0 ]; then
  echo "Only $days_until_xmas days until Christmas!"
else
  echo "Christmas has passed! Hope you had a great time!"
fi
```

### Tables

| Activity             | Santa's Verdict       | Elf Comments                    |
| :------------------- | :-------------------- | :------------------------------ |
| Iceberg Surfing      | Risky Business        | "Lost three surfboards!"        |
| Polar Bear Hugs      | Approach with Caution | "Fluffy but... brisk."          |
| Snow Fort Building   | Highly Recommended    | "Elf-sized doorways only."      |
| Aurora Light Chasing | Magical Experience    | "Better than Christmas lights!" |
| Penguin Parade       | Absolute Must-See     | "They're oddly organized!"      |

!!! success "Answer"
    Insert the answer to the objective here.

![Report](../img/objectives/o2/IOC_report.png)

## Response

!!! quote "Ed Skoudis"
    Well you just made that look like a piece of cake! Though I prefer cookies...I know where to find the best in town!

    Thanks again! See ya 'round!
