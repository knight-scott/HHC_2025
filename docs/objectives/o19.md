---
icon: material/tea-outline
---

# Gnome Tea

**Difficulty**: :fontawesome-solid-snowflake:{ .red }:fontawesome-solid-snowflake:{ .red }:fontawesome-solid-snowflake:{ .red }:fontawesome-regular-snowflake::fontawesome-regular-snowflake:<br/>
**Direct link**: [GnomeTea](https://gnometea.web.app/login)

## Objective

!!! question "Request"
    Enter the apartment building near 24-7 and help Thomas infiltrate the GnomeTea social network and discover the secret agent passphrase.

??? quote "Thomas Bouve"
    Hi again. Say, you wouldn't happen to have time to help me out with something?

    The gnomes have been oddly suspicious and whispering to each other. In fact, I could've sworn I heard them use some sort of secret phrase. When I laughed right next to one, it said "passphrase denied". I asked what that was all about but it just giggled and ran away.

    I know they've been using GnomeTea to "spill the tea" on one another, but I can't sign up 'cause I'm obviously not a gnome. I could sure use your expertise to infiltrate this app and figure out what their secret passphrase is.

    I've tried a few things already, but as usual the whole... Uh, what's the word I'm looking for here? Oh right, "endeavor", ended up with the rest of my unfinished projects.

## Hints

??? tip "GnomeTea"
    I heard rumors that the new GnomeTea app is where all the Gnomes spill the tea on each other. It uses Firebase which means there is a client side config the app uses to connect to all the firebase services.

??? tip "Statically Coded"
    Hopefully they did not rely on hard-coded client-side controls to validate admin access once a user validly logs in. If so, it might be pretty easy to change some variable in the developer console to bypass these controls.

## Solution

![tea-login](../img/objectives/o19/tea_login.png)

This challenge is the first challenge of Act 3 if you are going down the list of challenges as I did. The challenges are more involved in this Act and required a lot more time and focus, though I hope to distill that effort into a readable bits here.<br/>
This challenge links to a web app login, [GnomeTea](https://gnometea.web.app/login); starting with minimal information, the goal is to use an existing account to log into the app. I started in BurpSuite and began reading through the request and responses, as well as the `index.js`. 

![Burp](../img/objectives/o19/login-burp.png)

Notes like this are often sign posts for a CTF challenge, pointing us in the right direction. The TODO note mentions three collections that aren't locked down, `dms`, `tea`, and `gnomes`. I went ahead and attempted to login with generic login to record the response, but it didn't give me much insight. The *GnomeTea* hint tells us that the app is using Firebase though, and with the name of three collections, I thought I had enough to begin research. After reading up on Firebase, I was able to figure out what was needed for interacting with the Firestore database.<br/>
In the dev tools of the browser, I searched the index for "storageBucket:" to find the Firebase config.

![config](../img/objectives/o19/firebaseConfig.png)

With the config, it's possible to use the browser console to initialize the Firebase SDK so that the collections be queried directly. Since I was working with BurpSuite, I was also in Chromium and opened the DevTools from there to try initializing Firebase with the config. I fumbled around a bit trying to find a way to query the collections until I landed on HTTP query.<br/>
From the developer console, I was able to use the following to search the three collections found earlier. 

![initialized](../img/objectives/o19/initialized.png)
![failed](../img/objectives/o19/failure.png)

```javascript
const projectId = "holidayhack2025";
const apiKey = "AIzaSyDvBE5-77eZO8T18EiJ_MwGAYo5j2bqhbk";

async function queryCollection(collectionName) {
    const url = `https://firestore.googleapis.com/v1/projects/${projectId}/databases/(default)/documents/${collectionName}`;
    const response = await fetch(url);
    const data = await response.json();
    console.log(`=== ${collectionName.toUpperCase()} ===`);
    console.log(JSON.stringify(data, null, 2));
    return data;
}
```

After hitting enter, I searched each collection:

```javascript
// Query all three collections
await queryCollection('gnomes');
await queryCollection('tea');
await queryCollection('dms');
```

![tea_search](../img/objectives/o19/tea_search.png)

After running each of the queries, there was a massive amount of information. I used the 'copy' function to copy and paste the results in to my notes document for easier searching. I spent quite a bit of time just scrolling through the information. The `gnomes` collection wasn't to bad. There were 17 gnome profiles with bits of information. The main thing I noticed at this time about the `gnomes` collection was that of the 17 profiles, each with a driver's license and profile image, only one driver's license was not accesible. I was able to retrieve the log in email for each of the accounts though, and through the Discord channel I knew that brute forcing the password was not the indtended method.

| (index) | name                     | email                                   | license                                                                                                |
| ------- | ------------------------ | --------------------------------------- | ------------------------------------------------------------------------------------------------------ |
|         |                          |                                         |                                                                                                        |
| 0       | 'Professor Pumpernickel' | 'professorpumpernickel@gnomemail.dosis' | 'https://storage.googleapis.com/holidayhack2025.firâ€¦6J2bowmKiNVbITWmR4XsxjH7i492_drivers_license.jpeg' |
| 1       | 'Steamy Mcsteamface'     | 'steamymcsteamface@gnomemail.dosis'     | 'https://storage.googleapis.com/holidayhack2025.firâ€¦6nBUHcdxo2fLKSYqYyipr9iCOey2_drivers_license.jpeg' |
| 2       | 'Titus Toadstool'        | 'titustoadstool@gnomemail.dosis'        | 'https://storage.googleapis.com/holidayhack2025.firâ€¦7sQlw9l4xUOWSjDTphvLgKVEm0j1_drivers_license.jpeg' |
| 3       | 'Reggie Reggae'          | 'reggiereggae@gnomemail.dosis'          | 'https://storage.googleapis.com/holidayhack2025.firâ€¦G5c0vX06WOaEf1YKutqkur4HEU63_drivers_license.jpeg' |
| 4       | 'Chester Cherryhat'      | 'chestercherryhat@gnomemail.dosis'      | 'https://storage.googleapis.com/holidayhack2025.firâ€¦IvLFBZQgo3R6iteLHmShbWmctqo2_drivers_license.jpeg' |
| 5       | 'Glitch Mitnick'         | 'glitchmitnick@gnomemail.dosis'         | 'https://storage.googleapis.com/holidayhack2025.firâ€¦LA5w0EskgSbQyFnlp9OrX8Zovu43_drivers_license.jpeg' |
| 6       | 'Wizzy Stardust'         | 'wizzystardust@gnomemail.dosis'         | 'https://storage.googleapis.com/holidayhack2025.firâ€¦LOPFa6rXj6eB7uMVHu6IbKARYbe2_drivers_license.jpeg' |
| 7       | 'Gnorman Goldchain'      | 'gnormangoldchain@gnomemail.dosis'      | 'https://storage.googleapis.com/holidayhack2025.firâ€¦PyxedrsAN2bewsg4Rno9SsCqZHg2_drivers_license.jpeg' |
| 8       | 'Flex Muscle'            | 'flexmuscle@gnomemail.dosis'            | 'https://storage.googleapis.com/holidayhack2025.firâ€¦RQw0hYxlKIhsTUVPyR8ivrM3ls02_drivers_license.jpeg' |
| 9       | 'Pip Sparkletoes'        | 'pipsparkletoes@gnomemail.dosis'        | 'https://storage.googleapis.com/holidayhack2025.firâ€¦VgJCVlELJ6VfQTxeIt1dR5PWyiX2_drivers_license.jpeg' |
| 10      | 'Grizelda Grit-Tooth'    | 'grizeldagrittooth@gnomemail.dosis'     | 'https://storage.googleapis.com/holidayhack2025.firâ€¦golJeh7xg9YUvcj5nDugTssQPy62_drivers_license.jpeg' |
| 11      | 'Gnom-inator T-800'      | 'gnominatort800@gnomemail.dosis'        | 'https://storage.googleapis.com/holidayhack2025.firâ€¦jlm1nPFV5xWM4jQaokLHDb6K8kj1_drivers_license.jpeg' |
| 12      | 'Rowdy Root-Rouser'      | 'rowdyrootrouser@gnomemail.dosis'       | 'https://storage.googleapis.com/holidayhack2025.firâ€¦kmoZyOIt7sWgehQC8ovcsxXPWUS2_drivers_license.jpeg' |
| 13      | 'Barnaby Briefcase'      | 'barnabybriefcase@gnomemail.dosis'      | 'https://storage.googleapis.com/holidayhack2025.firâ€¦l7VS01K9GKV5ir5S8suDcwOFEpp2_drivers_license.jpeg' |
| 14      | 'Elderick Mossbeard'     | 'elderickmossbeard@gnomemail.dosis'     | 'https://storage.googleapis.com/holidayhack2025.firâ€¦prxA2hBSkhg3dkhkfzvnlGxCCfP2_drivers_license.jpeg' |
| 15      | 'Ferdinand Figgypudding' | 'ferdinandfiggypudding@gnomemail.dosis' | 'https://storage.googleapis.com/holidayhack2025.firâ€¦pwbhMFuRbkesddTrtT3gVRzv8Ux1_drivers_license.jpeg' |
| 16      | 'Bixby Jinglehat'        | 'bixbyjinglehat@gnomemail.dosis'        | 'https://storage.googleapis.com/holidayhack2025.firâ€¦q6GasKLVBYSo3g4c1mI6qXDpRmv2_drivers_license.jpeg' |
| 17      | 'Lil G'                  | 'lilg@gnomemail.dosis'                  | 'https://storage.googleapis.com/holidayhack2025.firâ€¦xK25sJX7usSwAJwAjpN8DMfzS872_drivers_license.jpeg' |

After reviewing everything, it seemed most likely that **Barnaby Briefcase** was going to be the intended way in.

### Barnaby Briefcase

Barnaby's profile is the only one that the driver's license returned an error when trying to open it.

![error](../img/objectives/o19/access-denied_barnaby.png)

There is still all of the DMs and Tea to comb through looking for anything useful. At this point in the challenge I'm still not sure what it is I am looking for and try some random keyword searches in both collections looking for anything password or Barnaby related.<br/>
The ammount of time I spent combing through all of the information I could find is not well reflected in the post-endeavour writing. I combed through everything though and found a few loose threads to pull on.

![eternity](../img/objectives/o19/eternity.jpg)

#### Findings

I started with the DMs. The `tea` collection was the larger of the two, and I was hoping to find something useful without the needle-in-a-haystack digging. This was naive of me, but I had to start somewhere. Working in the browser console wasn't as interactive as I needed and I dumped the collection to my local machine for investigation as mentioned above.<br/>
The first search was just for "barnaby" since that is the seemingly obvious account that is meant to be exploited. Searching the `dm` collection for Barnaby's name resulted in 27 results so I start scrolling through them. Towards the end of the results (23/27) is a dm to Barnaby from one of the other Gnomes, Glitch Mitnick. 

```json hl_lines="5"
{
      "name": "projects/holidayhack2025/databases/(default)/documents/dms/fHlgFwFTJeRkOFLK9DVj",
      "fields": {
        "lastMessage": {
          "stringValue": "Barnaby... we need to talk about password security. ðŸ˜… Please don't share passwords in DMs!"
        },
        "participants": {
          "arrayValue": {
            "values": [
              {
                "stringValue": "l7VS01K9GKV5ir5S8suDcwOFEpp2"
              },
              {
                "stringValue": "LA5w0EskgSbQyFnlp9OrX8Zovu43"
              }
            ]
          }
        },
        "lastMessageTime": {
          "timestampValue": "2025-09-30T19:20:52.957Z"
        },
        "participantNames": {
          "arrayValue": {
            "values": [
              {
                "stringValue": "Barnaby Briefcase"
              },
              {
                "stringValue": "Glitch Mitnick"
              }
            ]
          }
        }
    }
}
```

Progress! It looks like Barnaby might have some poor password security habits; maybe this is the way forward! I dug into the collection more, expecting to find an accidentally posted plaintext password in a communication from Barnaby...<br/>
I did not find the password.<br/>
I did, however, find the rest of Barnaby's conversation with Glitch which had more confirmation that I was on the right track.

!!! tip "Barnaby"
    Within the `dm` collection is the conversation between Barnaby and Glitch where Glitch asks for Barnaby's password. Barnaby appears to have learned from his earlier conversation though and responds with the following:
    !!! quote "Barnaby Briefcase
    "Sorry, I can't give you my password but I can give you a hint. My password is actually the name of my hometown that I grew up in. I actually just visited there back when I signed up with my id to GnomeTea (I took my picture of my id there)."

Barnaby's clue didn't help much at first, and I switched to the `tea` collection, still hoping to find the plaintext of Barnaby's password. Within the `tea` collection, there was at least one misleading result with Barnaby getting called out for keeping their password on a post-it note. The old password did not help with logging in either.<br/>
Through the assitance of the community within the HHC Discord I was given the final piece of the puzzle that I had overlooked. Based off the hint, I researched more about Firebase and methods of accessing stored files and got some assistance digging for the correct API.

??? warning "Enumerating"
    When I originally completed this challenge, I used a script to help enumerate the potential API endpoints. Since completing the challenge and starting work on the write-up, I had a catastrophic failure of the machine used lost a fair portion of the notes taken. That said, while slower, this is essentially the same steps.

Knowing I was on the right track and just needed to find the correct API, try them one at a time until the correct legacy route is found. 

### Admonitions

!!! warning "Anchor the decorations"
    Ensure that all festive decorations, especially electrical ones, are securely anchored. We donâ€™t want them floating off into the tropical sunset!

!!! info "Palm tree lighting tip"
    While on the island, make sure to hang your Christmas lights on a palm tree. Itâ€™s not only festive but also a great beacon for Santa to find you!

### Images

![Terminal output](../img/objectives/o5/terminal_output_o5.png)

### Diagrams

```mermaid
sequenceDiagram
  autonumber
  Santa->>Elf: Hey Elf, is the Naughty-or-Nice List secured?
  loop Security Check
      Elf->>Elf: Ensuring list is encrypted
  end
  Note right of Elf: Using candy-cane encryption!
  Elf-->>Santa: Safe and sound, Santa!
  Santa->>Reindeer: Rudolph, did you patch the sleigh's software?
  Note left of Reindeer: Checking for reindeerOS updates...
  Reindeer-->>Santa: All patched and glowing bright!
```

### Code blocks

```bash linenums="1" hl_lines="7" title="Countdown script (with line 7 highlighted)"
#!/bin/bash
echo "Christmas Holiday Countdown"

days_until_xmas=$(($(date -d "Dec 25" +%j) - $(date +%j)))

if [ $days_until_xmas -ge 0 ]; then
  echo "Only $days_until_xmas days until Christmas!"
else
  echo "Christmas has passed! Hope you had a great time!"
fi
```

### Tables

| Activity             | Santa's Verdict       | Elf Comments                    |
| :------------------- | :-------------------- | :------------------------------ |
| Iceberg Surfing      | Risky Business        | "Lost three surfboards!"        |
| Polar Bear Hugs      | Approach with Caution | "Fluffy but... brisk."          |
| Snow Fort Building   | Highly Recommended    | "Elf-sized doorways only."      |
| Aurora Light Chasing | Magical Experience    | "Better than Christmas lights!" |
| Penguin Parade       | Absolute Must-See     | "They're oddly organized!"      |

!!! success "Answer"
    Insert the answer to the objective here.

## Response

!!! quote "Thomas Bouve"
    Excellent! Now we can communicate with the gnomes. When I tried to talk to one just now it said "passphrase accepted".

    I asked what they were up to and it said something about going to the old warehouse/data center at the appointed time for the next meeting. No clue what that means though.

    Anyhoo, that's a pretty big item you helped remove from my pile of unfinished hacking projects. I really appreciate the assist!